{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}

<!-- 
  Startseite der Anwendung.
  Zeigt eine Liste von Produkten, die von einer externen API geladen werden.
  Nutzer k√∂nnen Produkte als Favoriten markieren ("Gef√§llt mir").
  Bereits gelikte Produkte werden entsprechend gekennzeichnet.
-->

<section class="home-header">
  <h1><span>Products of Project-Review</span></h1>
</section>

<div class="product-list-wrapper">
  <div class="product-list-container">
    <!-- Container f√ºr die Produktliste. Die Produkte werden per JavaScript dynamisch eingef√ºgt.-->
    <div id="product-list" class="product-list-container">
      <!-- 
        JavaScript-Bereich:
        - L√§dt Produkte von einer externen API (dummyjson.com)
        - Pr√ºft, welche Produkte bereits als Favorit markiert wurden (aus der Session)
        - Zeigt f√ºr jedes Produkt eine Karte mit Bild, Titel, Beschreibung und Like-Button
        - Erm√∂glicht das Liken und Entliken von Produkten (Kommunikation mit dem Backend)
      -->
      <script>
        // Set mit bereits gelikten Produkten aus der Session (wird vom Backend bereitgestellt)
        const liked_products_in_db = new Set(JSON.parse('{{ session.get("liked_products", []) | tojson | safe }}'));

        // Nach dem Laden der Seite werden die Produkte von der API geladen und angezeigt
        document.addEventListener("DOMContentLoaded", async () => {
          // API-Aufruf: Holt maximal 20 Produkte
          const response = await fetch("https://dummyjson.com/products?limit=20");
          const data = await response.json();
          const products = data.products;
          const container = document.getElementById("product-list");

          // F√ºr jedes Produkt wird eine Karte erstellt und in den Container eingef√ºgt
          products.forEach(product => {
            const card = document.createElement("div");
            card.className = "product-card";
            // Pr√ºfen, ob das Produkt bereits geliked wurde
            const isLiked = liked_products_in_db.has(product.title);

            // HTML-Inhalt der Produktkarte
            card.innerHTML = `
              <img src="${product.thumbnail}" alt="${product.title}" width="100">
              <h4>${product.title}</h4>
              <p>${product.description}</p>
              ${isLiked ? `<p>Bereits als Favorit markiert üëç</p>` : `<p></p>`}
              <button onclick="likeProduct('${product.title}')"> Gef√§llt mir! </button>
            `;

            container.appendChild(card);
          });
        });

        // Funktion zum Liken eines Produkts (sendet POST an /like)
        function likeProduct(title) {
          fetch("/like", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ title }),
          }).then(() => {
            window.location.reload(); // Seite neu laden, um √Ñnderungen anzuzeigen
          });
        }

        // Funktion um ein Like zu entfernen eines Produkts (sendet POST an /unlike)
        function unlikeProduct(title) {
          fetch("/unlike", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ title }), //title kommt aus der Produktkarte
          }).then(() => {
            window.location.reload();
          });
        }
      </script>
    </div>
  </div>
</div>

{% endblock %}